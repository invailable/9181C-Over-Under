/*----------------------------------------------------------------------------*/
/*                                                                            */
/*    Module:       main.cpp                                                  */
/*    Author:       C:\Users\alex_     W Alex                                 */
/*    Created:      Mon Aug 14 2023                                           */
/*    Description:  V5 project                                                */
/*                                                                            */
/*----------------------------------------------------------------------------*/

// ---- START VEXCODE CONFIGURED DEVICES ----
// Robot Configuration:
// [Name]               [Type]        [Port(s)]
// FrontLeft            motor         18              
// FrontRight           motor         8               
// BackLeft             motor         20              
// BackRight            motor         10              
// Controller1          controller                    
// Flap1                digital_out   A               
// Catapult             motor         5               
// Intake               motor         17              
// Rotation             rotation      4               
// MiddleLeft           motor         19              
// MiddleRight          motor         9               
// Inertial1            inertial      1               
// ---- END VEXCODE CONFIGURED DEVICES ----


#include "vex.h"
#include <string.h>
#include <string>
#include <iostream>
#include <sstream>

using namespace std;
using namespace vex; 
int go;
int rotate;
int count = 46;
string wing1 = "";
string intake = "";

string save = "492001100004920011000049160110000491601100004915011000049160110000491701100004920010000249200100002492001000064919010000949180100011491801000154918010002349180100026491701000354917010003849170100047492101000524937010005449490100059494901000614949010006949490100073494901000774949010007949490100081494901000824949010008349490100084494800000854936000008549360000085491000000854900000008549000000085490000000854900000008549000000085490000000864905000008949050000092491800000964925000009849240000106492200001124923000011849230000125492200001334913000014049120000147491300001514913000016249220000168494100001744949000017749490000184494900001884949000019049490000193494900001964949000019749490000198494900001994949000019949570000199497300001994973000019949990000199499900001984999000019849990000198499900001974999000019649990000192499900001884949000018449490000179494900001744949000017049490000166494900001644949000016349490000161494900001604949000015949490000159484900001594349000015943490000159364900001593649000015929510000159295100001592156000016021560000160215600001602153000016021490000160214900001602149000016020490000159204900001592049000015920490000159214900001582149000015821490000157205000001572061000015620700000156207500001562175000015621750000155216900001552149000015520490000154204900001522149000015021490000148204900001432049000013920490000135204900001322149000013021490000129204900001272049000012719490000127184900001271849000012719370000128193700001281920000012819200000129192000001301921000013019210000132194900001341849000013718490000140204900001412049000014620490000148204900001542049000015820490000161194900001641949000016620490000168194900001691949000016919490000169194900001691949000016818490000167204900001662049000016518490000163194900001621949000016119490000160194900001602049000015920490000159184900001591849000015918490000159184900001591149000016009490000160074900001600349000016003490000161004900001610049000016100490000161004900001620049000016200490000162004900001620049000016200490000162004900001620049000016200490000162004900001620048000016200480000162004900001620049000016200490000163004900001630040000016300340000163002000001630018000016300180000163004900001630049000016300490000164004900001640049000016500490000167004900001680049000017000490000171004900001730032000017600130000176000000001780000000017900000000180000000001810037000018400490000186004900001890049000019300490000197004900001990049000020000490000201004900002020049000020300490000203004900002030049000020400490000204004900002040049000020400490000203004900002030049000020100490000199004900001980049000019600490000195004900001940049000019300490000191004900001900049000018700490000186004900001860049000018500490000183004900001830049000018300490000183284900001832849000018374490000182744900001829949000018299490000182994900001829949000018299490000182994900001829949000018299490000182994900001829949000018299490000182994900001829949000018299490000182994900001829949000018299490000182994900001829949000018299490000182994900001819949000018199490000181994900001819949000018199490000182994900001829949000018299490000182994900001829949000018299490000182994900001829949000018299490000182674900001824949000018249490000183494900001834949000018349490000181384900001783849000017725490000175124900001740049000017200490000171004900001700049000016900490000169004900001680049000016800490000168004900001670049000016700000000167000000001670000000016700000000167000000001690000000017100000000174000000001770015000018000490000185004900001890049000019400490000198004900002030049000020800490000213004900002170049000022100490000224004900002260049000023000490000232004900002330049000023500490000236004900002380049000024000490000240004900002410049000024400490000245004900002490049000025200490000252004900002543849000025699490000257994900002589949000025999490000262994900002659949000026999490000271994900002739949000027499490000275995200002769957000027799570000277996200002789966000027999840000279999900002809999000028099990000280999900002809999000027999990000276999900002724999000026849990000263499900002614975000025749490000255494900002534949000025249490000251494900002501549000024800490000248004900002470049000024700490000246004900002460049000024600490000245004900002440049000024400490000244004900002440049000024400490000244004900002440049000024400490000244004900002440049000024400490000244004900002440049000024400490000244494900002449949000024499490000244994900002439949000024399490000243994900002429949000024299480000241993400002419934000024199290000240992800002409926000024099160000240990000002409900000024099000000240990000002417300000024249000000245490000002474900000025049000000254490000002564900000026249490000267494900002724949000027549490000282494900002844949000028949490000291494900002934949000029549490000296494900002964949000029649490000296484900002954849000029543490000294394900002942942000029428380000294273100002942731000029428290000294283100002942940000029529400000295314000002963148000029731480000300314900003023149000030331490000306314900003093149000031131490000313314900003173149000031931490000320294900003212949000032128490000321284900003212849000031927490000318274900003182854000031628540000316285400003152853000031528510000314284900003142749000031427490000314274900003132649000031323490000313214900003132149000031221490000312214900003122149000031121490000311214900003112149000031121490000311214900003112149000031122490000311224900003112249000031122490000311224900003112149000031121490000311214900003112149000031122490000311224900003112255000031121600000312226200003122174000031221740000312217900003122179000031221840000311218300003092182000030721800000304217200003012160000029921490000293224900002882249000028321491000278214910002762149100027122491000266214910002612149100025721491000254215410002522263100025022791000249219310002492193100024922991000250239910002502499100025127991000251279910002503599100024949821000247494910002444949100024149491000238494910002344949100023149711000229498110002274987100022549871000225498910002254989100022549831000225497510002254960100022449601000222494910002214949100021949491000217494910002164949100021449771000213498410002124984100021249791000211496910002114969100021149691000210494910002104949100020849571000206495710002054957100020449611000203495410002034949100020249491000202494910002024849100020243491000202404910002023949100020239491000202314910002023149100020231491000202314910002022949100020229491000202315410002023158100020230621000203296310002032963100020329641000203286310002032861100020328611000203286110002022861100020128681000199287710001972877100019428771000191287710001872880100018428821000180278010001772780100017327491000169244910001652149100016118491000156144910001511449100014614491000141144910001361437100013212181000129100010001260900100012309001000121090010001200900100011908001000118060010001190600100012006001000122014910001250049100012900491000133004910001370049100014200491000147004910001520049100015600491000160004910001620049100016500491000167004910001680049100016800491000168004910001670049100016600491000163004910001610049100015900491000156004910001534349100015098491000149994910001489949100014799491000147994910001479949100014799491000147994910001479949100014899491000149994910001499949100015099491000150994910001519949100015199491000151994910001519949100015099491000150994910001509949100015099491000150994900001509949000015099490000150994900001509949000015099490000150994900001509949000015099490000150994900001504949000014949490000149493200001484900000014749000000146490000001454900000014449000000143490000001424900000014149000000140490000001404900000014149000000142490000001434900000014449000000145490000001464900000014849000000150490000001524900000015449000000157490000001594900000016249000000165490000001694900000017249000000176490000001794900000018249000000185490000001874900000019049000000192490000001954900000019749000000200490000002024900000020549000000207490000002104900000021349000000216490000002184900000022149000000224490000002274900000023049000000233490000002364900000023949000000243490000002464900000025049000000254490000002584900000026349000000265490000002694900000027349000000277490000002804949000028249490000286494900002904949000029349490000297494900003004949000030149490000301494900003014949000030149490000300494900002994949000029949490000299494900002994949000029949490000299444900002994449000029941490000299374900002993749000029934490000299334900002993349000029934490000299334900002993349000029933490000299334900002993349000029832400000298324000002983240000029832400000298324000002983146000029829490000298294900002992749000030027490000301234900003032149000030520490000307204900003092049000031020490000312204900003132049000031320490000313204900003132049000031320490000313214900003122049000031220570000311206000003112060000031020630000310206800003102068000031021770000309207900003092184000030820920000307219800003052099000030320990000299209900002952099000029120990000286209900002812099000027520990000268209900002612099000025421990000247209900002392099000023220990000225219900002212199000021421990000207209900001992099000019320990000186209300001792050000017220490000164204900001572049000015040490000143494900001364949000013049490000124494900001194949100011549491000111494910001094949100010749441000105491110001044900100010349001000103490010001034900100010349001000104490010001054900100010749001000110490010001134900100011749121000122494910001284949100013449491000140494910001464949100015149491000155494910001584949100016049491000162494910001634949100016449501000164495010001643563100016424671000164246710001641467100016404641000164004910001630049100016300491000162004910001610049100015900491000158004910001570049100015700491000156004910001550049100015500491000154004910001540049100015400491000154004910001550049100015500491000156004910001560049100015700491000159004910001600049100016200491000165004910001680049100017200491000176014910001798449100018299491000183994910001849949100018499491000184994910001849949100018399491000183994910001829949100018299491000182994910001829949100018299491000181994910001819949100018199491000181994910001819949100018099491000180994910001809949000018099490000180994900001809949000018099490000180994900001809949000018049290000180491400001804900000018049000000180490000001804900000018049000000180490000001814900000018249000000183490000001844900000018549000000186490000001894900000019149000000194490000001984900000020349000000208490000002144910000022149390000228494900002354949000024349490000251494900002594949000026449490000267494900002684949000026844490000269354900002693549000026935490000269264900002692549000026825490000268254900002682549000026725490000267254900002662549000026525490000265254900002652549000026425490000264254900002642549000026525490000265254900002652549000026525490000265254900002652549000026525490000264254900002642553000026425530000264255300002642553000026425530000264245300002652453000026524510000264245100002642349000026422490000263224900002622249000026122490000260234900002592249000025822490000257236400002572376000025623980000256239800002552399000025523990000253239900002512399000024922990000245236900002412369000023623490000231234900002272349000022423490000221234900002172349000021323490000209234900002052349000020223490000200234900001982349000019623490000195234900001952349000019523490000195235000001962350000019722510000198225100001992349000020023490000201234900002022349000020323490000204234900002042349000020423490000204234900002032349000020322490000202234900002022249000020123490000201234900002012349000020023490000200234900002002349000020023490000200234900002002349000020023490000201234900002012349000020123490000201234900002012349000020123490000201234900002012349000020123490000201237300002012395000020123950000201239900002012399000020122990000201239900002002399000019823990000196239900001932399000018923990000187239900001822399100017723991000171239910001652399100015823991000151234910001432349100013523491000127234910001192249100011123491000103234900000952349000008923490000083235000000772350000007323490000068234900000652349000006223490000059234900000582349000005723490000056234900000562349000005722440000058232900000592200000006022000000061220000000622200000006323000000064230000000652300000006730000000070300000000734700000007744490000082344900000873449000009334490000099214900001060849000011308490000120004900001270049000013400490000140004900001460060000015100600000155009900001590099000016300990000166009900001690099000017000990000170009900001690099000016800990000166009900001630099000016000990000157009900001530099000014900990000145009900001400099000013600990000131009900001260099000012100990000116004900001110049000010600490000101004900000950049000009000490000085004900000810049000007700490000073004900000700049000006700490000066004900000640049000006300490000063004900000630049000006400490000064004900000649949000006499490000064994900000649949000006399490000063994900000639949000006399490000063994900000639949000006399490000063994900000649949000006499490000064994900000659949000006599490000066994900000669949000006699490000066494900000664949000006649490000066494900000664949000006626490000066074900000670749000006700470000067004700000680000000006800000000068000000000680000000006800000000069000100000700049000007100490000074004900000760049000007900490000082004900000850049000008800490000090004900000920049000009400490000095004900000970049000009800490000099005700000990070000010000970000100009700001000099000010000990000101009900001000099000009900990000098009900000960099000009500490000094004900000938249000009282490000091824900000909949000008999490000089994900000899949000008999490000088994900000889949000008899490000087994900000879949000008799490000087994900000879949000008799490000086994900000869966000008699660000086657800000864978000008649600000086004900000860049000008600490000086004900000850049000008400490000083004900000820049000008100490000079004900000780049000007700490000076004900000750049000007400490000073004900000720049000007100490000070004900000700049000006900490000069004900000690049000006900490000068004900000680049000006800490000068004900000670049000006500490000063994900000619949000005899490000056994900000569949000005699490000056994900000559949000005599490000054990000000549900000005499000000054990000000549900000005599000000056990000000589900000006099000000063990000000669900000006999000000072990000000769900000008099000000084990000000899900000009399000000098990000001039900000010899000000113990000001189900000012399000000128990000001349900000013999000000144";
competition Competition;

//spins the chassis motors
void chassis(int left, int right){
  FrontLeft.spin(vex::forward, left, percent);
  FrontRight.spin(vex::forward, right, percent);
  MiddleLeft.spin(vex::forward, left, percent);
  MiddleRight.spin(vex::forward, right, percent);
  BackLeft.spin(vex::forward, left, percent);
  BackRight.spin(vex::forward, right, percent);
}

//brakes all chassis motors
void halt(){
  FrontLeft.stop(brake);
  FrontRight.stop(brake);
  MiddleLeft.stop(brake);
  MiddleRight.stop(brake);
  BackLeft.stop(brake);
  BackRight.stop(brake);
}

void CalibrateInertial()
{
  Inertial1.calibrate();
  while (Inertial1.isCalibrating()) {
      wait(800, msec);
  }
  wait(800, msec);
  Controller1.rumble(".");
}
//corrects the orientation of the robot when off course

void correct_orientation(int sign, string correction){
  cout << "actual: " << Inertial1.rotation(degrees) << endl;
  int c = atoi(correction.c_str());
  if(sign == 0){
    c = c * -1;
  }
  cout << c << endl;
  cout << sign << endl;
  
  if(Inertial1.rotation(degrees) < c - 20){
    while(Inertial1.rotation(degrees) < c - 10){
      cout << "correcting1" << endl;
      cout << "actual: " << Inertial1.rotation(degrees) << endl;
      cout << c << endl;
      chassis(15, -15);
      wait(20, msec);
    }
  }
  else if(Inertial1.rotation(degrees) > c + 20){
    while(Inertial1.rotation(degrees) > c + 10){
      cout << "correcting2" << endl;
      cout << "actual: " << Inertial1.rotation(degrees) << endl;
      cout << c << endl;
      chassis(-15, 15);
      wait(20, msec);
    }
  }
  
}
void pre_auton(void) {
  vexcodeInit();
  CalibrateInertial();
}

void autonomous(void) {
  //catapult code
  Catapult.setVelocity(100, percent);
  Intake.spin(vex::forward, -50, percent);
  while(count > 0){
    count -= 1;
    Catapult.spinFor(vex::forward, 1, turns);
  }
  Intake.stop();
  Catapult.spinFor(vex::forward, 0.6, turns);
  //reading the save file
  while (1) {
    if(save.length() != 0){
      // spin chassis
      go = (save[0] - 48) * 10 + save[1] - 48;
      rotate = (save[2] - 48) * 10 + save[3] - 48;
      wing1 = save[4];
      intake = save[5];
      if(go != 49 || rotate != 49){
        //if the robot is not rotating, do not drift rotation
        if(rotate == 49){
          chassis(go * 2 - 99, go * 2 - 99);
        }
        //if the robot is not going forward, spin slower
        else if(go == 49){
          chassis((rotate * 2 - 99) / 1.5, -(rotate * 2 - 99) / 1.5);
        }
        //otherwise, just drive
        else{
          chassis(((go * 2 - 99)) + (rotate * 2 - 99), ((go * 2 - 99)) - (rotate * 2 - 99));
        }
      }
      else{
        halt();
      }
      if(wing1 == "1"){
        Flap1.set(true);
      }
      else{
        Flap1.set(false);
      }
      if(intake == "2"){
        Intake.spin(vex::forward, 100, percent);
      }
      else if(intake == "1"){
        Intake.spin(vex::forward, -100, percent);
      }
      else{
        Intake.stop(hold);
      }
      if(save[6] == '0'){
        cout << "ahdowabcuis" << endl;
        correct_orientation(0, save.substr(7, 4));
      }
      else if(save[6] == '1'){
        cout << "dwacdagds" << endl;
        correct_orientation(1, save.substr(7, 4));
      }
      //delete read parts of save file
      for (int i = 0; i < 11; i++) {
        save.erase(save.begin());
      }
    }
    else{
      halt();
      break;
    }
    wait(20, msec);
  }
}

/*---------------------------------------------------------------------------*/
/*                                                                           */
/*                              User Control Task                            */
/*                                                                           */
/*  This task is used to control your robot during the user control phase of */
/*  a VEX Competition.                                                       */
/*                                                                           */
/*  You must modify the code to add your own robot specific commands here.   */
/*---------------------------------------------------------------------------*/

void usercontrol(void) {
}

//
// Main will set up the competition functions and callbacks.
//
int main() {
  // Set up callbacks for autonomous and driver control periods.
  Competition.autonomous(autonomous);
  Competition.drivercontrol(usercontrol);

  // Run the pre-autonomous function.
  pre_auton();

  // Prevent main from exiting with an infinite loop.
  while (true) {

    wait(100, msec);
  }
}